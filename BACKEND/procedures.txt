-- list all books with all filters applied, mostm√°r elv jo
DELIMITER //
CREATE PROCEDURE IF NOT EXISTS listBooksFiltered(
  IN title VARCHAR(255),
  IN genre VARCHAR(255),
  IN author VARCHAR(255),
  IN realease_date VARCHAR(255),
  IN languages VARCHAR (255),
  IN ISBN VARCHAR(13),
  OUT ISBN_id INT
) BEGIN
SELECT DISTINCT
  book.ISBN_id INTO ISBN_id
FROM
  book
  INNER JOIN (
    books_genres_conn
    INNER JOIN genres ON genres.genre_id = books_genres_conn.genre_id
  ) ON book.ISBN_id = books_genres_conn.ISBN_id
  INNER JOIN (
    books_authors_conn
    INNER JOIN authors ON authors.author_id = books_authors_conn.author_id
  ) ON book.ISBN_id = books_authors_conn.ISBN_id
  INNER JOIN publishers ON publishers.publisher_id = book.publisher_id
  INNER JOIN languages ON languages.lang_id = book.lang_id
  INNER JOIN inventory ON inventory.ISBN_id = book.ISBN_id
WHERE
  book.title LIKE CONCAT("%", title, "%")
  AND genres.genre = genre
  AND authors.author = author
  AND CAST(book.release_date AS VARCHAR(255)) LIKE release_date
  AND languages.lang = language
  AND book.ISBN = ISBN
  AND inventory.available = TRUE;
END;//
DELIMITER;
